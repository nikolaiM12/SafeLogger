# 🔍 Анализ на риска при логване на потребителски низове

Логването на потребителски данни без предпазни мерки крие няколко ясно дефинирани уязвимости. По-долу са описани четири основни типа риск, с кратки концептуални примери и предложени мерки за предотвратяване.

---

## 1️⃣ Format-string injection (изтичане на чувствителна информация)  
**Описание:** Ако потребителският низ се използва като форматен шаблон (например чрез `string.Format`) и към него се подават вътрешни стойности като аргументи, може да се получи неволно изписване на тези стойности в лог файла.

**Пример:** Код извиква `string.Format(userMsg, secret)`, когато `userMsg` съдържа placeholder (напр. `{0}`), в лога се записва стойността на `secret` вместо буквения низ на потребителя.

---

## 2️⃣ Log forging / CR-LF injection (манипулация на лог файлове)  
**Описание:** Потребител може да вкара символи за нов ред (`\r`, `\n`) в входа; при запис това разделя един лог ред на няколко видими записа. Резултатът е възможност за въвеждане на подвеждащи или фалшиви записи, които приличат на системни събития.

**Пример:**
`userMsg` съдържа `\n`, при запис в лога се появяват два реда вместо един — част от съобщението изглежда като отделен лог запис (например като фалшиво алармено съобщение).

---

## 3️⃣ Exceptions / DoS чрез големи или неправилни низове  
**Описание:** Неконтролирани големи входове или неправилни placeholder конструкции могат да предизвикат изключения (напр. `FormatException`), прекомерно писане върху диска или изчерпване на ресурси, водещо до забавяне или отказ на услугата.

**Пример:** Поток от много големи `userMsg` или `userMsg`, съдържащи некоректни placeholder-и, причинява многократно писане и/или `FormatException` при форматиране. Резултатът е забавяне на системата или частичен/пълен отказ.

---

## 4️⃣ Curly-brace interpretation (нарушаване на структурирани логове)  
**Описание:** Системите за структурирано логване интерпретират фигурни скоби `{}` като placeholders. Непочистен вход с такива символи може да промени структурата на лог записа, да доведе до грешка при обработка или да създаде неконсистентни полета в логовете.  

**Пример:** `userMsg` съдържа `{username}` лог системата търси стойност за `username` или променя структурата на записа, което води до грешка при парсване или некоректен формат на лог файла.

---
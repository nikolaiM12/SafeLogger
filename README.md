# 🧾 SafeLogger - Документация 

Този документ описва защо избраните защитни мерки в класа  `SafeLogger` са **необходими и достатъчни**, както и какви подобрения могат да се приложат в по-реална среда.

📄 **Пълен анализ на риска:** [SafeLogger_RiskAnalysis.md](src/SafeLogger_RiskAnalysis.md)

---

## 📘 Обща информация

Проектът демонстрира подход за **сигурно логване на потребителски вход**, като елиминира основните уязвимости, свързани с неподготвени или злонамерени низове.

**Съдържа:**
- `Homework_1/Implementation/SafeLogger.cs` – защитена имплементация на логер  
- `Homework_1/Contracts/ISafeLogger.cs` – интерфейс за дефиниране на поведението на логера  
- `Homework_1/VulnerableLogger.cs` – уязвима версия за демонстрация на рисковете  
- `Homework_1/Program.cs` – входна точка (пример за използване в конзолното приложение)  
- `Homework_1.Tests/SafeLoggerTests.cs` – unit тестове, които проверяват поведението и сигурността на логера
- `SafeLogger_RiskAnalysis.md` - анализ на основните типове рискове, произтичащи от уязвимия код (format injection, log forging, DoS, curly-brace interpretation) 
- `README.md` – кратка документация с обяснения и препоръки  

---

## ✅ Реализирани защитни мерки
|  №  | Мярка                                               | Описание                                                                             |
| :-: | --------------------------------------------------- | ------------------------------------------------------------------------------------ |
|  1  | **Ескейпване на фигурни скоби `{}`**                | Предотвратява форматни инжекции, като не позволява входът да се тълкува като шаблон. |
|  2  | **Ескейпване на нови редове (`\r`, `\n`)**          | Гарантира, че всеки лог запис е само един ред, елиминирайки log forging атаки.       |
|  3  | **Ограничение на дължината и маркер `[truncated]`** | Предпазва от прекомерно писане и отказ на услуга при много големи входове.           |
|  4  | **Обработка на изключения с диагностичен лог**      | При грешка логерът записва в отделен файл, без да прекъсва работата на приложението. |

---

## 🧰 Пример за използване
Следният пример може да се постави в `Program.cs` на конзолното приложение (`Homework_1`):
```csharp
using Homework_1.Implementation;

var logger = new SafeLogger("app.log");
logger.LogUserMessage("User input: Hello {0} \n This is safe!");
```
### 🪶 Примерен резултат в лога:
```python
2025-10-31T21:45:00.0000000Z [INFO] User input: Hello {{0}} \n This is safe!
```

---

## 🚀 Възможни подобрения
В реална производствена среда могат да се приложат и допълнителни механизми за повишена сигурност и проследимост:
 - **Маскиране на чувствителни данни** – например частично скриване или хеширане на JWT токени, пароли или идентификатори.
 - **JSON-базирано структурирано логване** – по-добро форматиране и лесна интеграция с външни системи за наблюдение.
 - **Защита и ротация на лог файловете** – контрол на достъпа, автоматично архивиране и предотвратяване на неограничен растеж.
 - **Проверка на целостта** – добавяне на хеш/подпис към записите за откриване на неоторизирани промени.

---

## 🗂️ Структура на проекта

```
src/
├── Homework_1/
│ ├── Implementation/
│ │ └── SafeLogger.cs
│ ├── Contracts/
│ │ └── ISafeLogger.cs
│ ├── VulnerableLogger.cs
│ └── Program.cs
│
├── Homework_1.Tests/
│ └── SafeLoggerTests.cs
│
├──SafeLogger_RiskAnalysis.md
├──README.md
```
---

## 🧪 Изпълнение на тестовете

Тестовете са написани с **xUnit** и могат да бъдат стартирани с командата:

```bash
dotnet test
```
При успешно изпълнение ще бъдат създадени временни лог файлове в папката `Logs/` в `Homework_1.Tests` проекта.
